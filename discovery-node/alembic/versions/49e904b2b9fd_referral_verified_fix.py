"""Referral-verified fix

Revision ID: 49e904b2b9fd
Revises: 3ea8467836d8
Create Date: 2022-01-31 22:19:25.264961

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '49e904b2b9fd'
down_revision = '3ea8467836d8'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    connection = op.get_bind()
    connection.execute(
        """
        INSERT INTO challenges
        VALUES ('ref-v', 'aggregate', 1, TRUE, 500, 0)
        ON CONFLICT DO NOTHING;

        UPDATE user_challenges
        SET challenge_id = 'ref-v'
        WHERE 
            challenge_id = 'referrals-verified' OR
            challenge_id = 'r-v';

        DELETE from challenges
        WHERE id = 'r-v';

        DELETE from challenges
        WHERE id = 'referrals-verified';
        """
    )


def downgrade():
    pass
